# Improvise a Jazz Solo with an LSTM Network (Keras)
**Goal**
- Apply an LSTM to music gereration.
- Generate your own jazz music with deep learning.

### Building the model
In this part you will build and train a model that will learn musical patterns. To do so, you will need to build a model that takes in X of shape <img src="https://latex.codecogs.com/gif.latex?(m,&space;T_x,&space;78)"> and Y of shape <img src="https://latex.codecogs.com/gif.latex?(T_y,&space;m,&space;78)">. We will use an LSTM with 64 dimensional hidden states. Lets set `n_a = 64`. 

Implement `djmodel()`. You will need to carry out 2 steps:
1. Create an empty list "outputs" to save the outputs of the LSTM Cell at every time step.
2. Loop for <img src="https://latex.codecogs.com/gif.latex?t&space;\in&space;1,&space;\ldots,&space;T_x">:

    A. Select the "t"th time step vector from X. The shape of this selection should be (78,). To do so, create a custom [Lambda](https://keras.io/layers/core/#lambda) layer in Keras by using this line of code:
```
    x = Lambda(lambda x: X[:,t,:])(X)
```
It is creating a "temporary" or "unnamed" function (that's what Lambda function are) that extracts out the appropriate one-hot vector, and making this function a Keras `Layer` object to apply to `X`.
    B. Reshape x to be (1,78). You may find the `reshapor()` layer (defined below) helpful. 
    C. Run x through one step of LSTM_cell. Remember to initialize the LSTM_cell with the previous step's hidden state <img src="https://latex.codecogs.com/gif.latex?a"> and cell state <img src="https://latex.codecogs.com/gif.latex?c">. Use the following formatting:
```python
    a, _, c = LSTM_cell(input_x, initial_state=[previous hidden state, previous cell state])
``` 
    D. Propagate the LSTM's output activation value through a dense+softmax layer using `densor`.
    E. Append the predicated value to the list of "outputs"
**Using global Keras layers objects variables**

## Generating music

### Predicting & Sampling
**Implement steps:**

- Use `LSTM_Cell`, which inputs the previous step's `c` and `a` to generate the current step's `c` and `a`.
- Use `densor` (defined previously) to compute a softmax on `a` to get the output for the current step.
- Save the output you have just generated by appending it to `outputs`.
- Sample x to the be "out"'s one-hot version (the prediction) so that you can pass it to the next LSTM's step.We have already provided this line of code, which uses a [Lambda](https://keras.io/layers/core/#lambda) function. 
```python
x = Lambda(one_hot)(out) 
```

### Predict_and_sample
**3 steps**
- Use your inference model to predict an output given your set of inputs. The output `pred` should be a list of length <img src="https://latex.codecogs.com/gif.latex?T_y"> where each element is a numpy-array of shape (1, n_values).
- Convert `pred` into a numpy array of <img src="https://latex.codecogs.com/gif.latex?T_y"> indices. Each index corresponds is computed by taking the `argmax` of an element of the `pred` list
- Convert the indices into their one-hot vector representations

## Useful Functions
**Keras:**
- [Reshape()](https://keras.io/layers/core/#reshape): Reshapes an output to a certain shape.
- [LSTM()](https://keras.io/layers/recurrent/#lstm): Long Short-Term Memory layer - Hochreiter 1997. 
- [Dense()](https://keras.io/layers/core/#dense): Just your regular densely-connected NN layer.
- [to_categorical()](https://keras.io/utils/#to_categorical): Converts a class vector (integers) to binary class matrix.

**Numpy**
- [numpy.argmax](https://docs.scipy.org/doc/numpy/reference/generated/numpy.argmax.html)

## Summary
- A sequence model can be used to generate musical values, which are then post-processed into midi music.
- Fairly similar models can be used to generate dinosaur names or to generate music, with the major difference being the input fed to the model.
- In Keras, sequence generation involves defining layers wiht shared weights, which are then repeated for the different time steps <img src="https://latex.codecogs.com/gif.latex?1,&space;\ldots,&space;T_x">